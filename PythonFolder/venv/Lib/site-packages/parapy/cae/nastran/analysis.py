#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
# Copyright (C) 2016-2021 ParaPy Holding B.V.
#
# This file is subject to the terms and conditions defined in
# the license agreement that you have received with this source code
#
# THIS CODE AND INFORMATION ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY
# KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR
# PURPOSE.

import os
from subprocess import call

from parapy.cae.nastran import globs


def run_nastran(bdf_path, nastran_path=None):
    bdf_path = os.path.abspath(bdf_path)
    if not os.path.exists(bdf_path):
        msg = "Couldn't find .bdf file at '{}'."
        raise RuntimeError(msg.format(bdf_path))
    if nastran_path is None:
        nastran_path = globs.NASTRAN_PATH
    else:
        nastran_path = os.path.abspath(nastran_path)
    if not os.path.exists(nastran_path):
        msg = ("Couldn't find Nastran executable at '{}', please provide "
               "nastran_path or set globs.NASTRAN_PATH")
        raise RuntimeError(msg.format(nastran_path))
    # TODO: add extra command line arguments here
    args = []
    call([nastran_path, bdf_path] + args)
    return True


if __name__ == '__main__':
    example_bdf = os.path.join(globs.NASTRAN_DOC,
                               "seug", "chapter7", "Freedom",
                               "setree", "seset-setree.bdf")
    run_nastran(example_bdf)
