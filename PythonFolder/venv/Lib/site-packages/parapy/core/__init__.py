#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
# Copyright (C) 2016-2021 ParaPy Holding B.V.
#
# This file is subject to the terms and conditions defined in
# the license agreement that you have received with this source code
#
# THIS CODE AND INFORMATION ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY
# KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR
# PURPOSE.

#
#      _____                _____          _____
#     |  __ \              |  __ \        / ____|
#     | |__) |_ _ _ __ __ _| |__) |   _  | |     ___  _ __ ___
#     |  ___/ _` | '__/ _` |  ___/ | | | | |    / _ \| '__/ _ \
#     | |  | (_| | | | (_| | |   | |_| | | |___| (_) | | |  __/
#     |_|   \__,_|_|  \__,_|_|    \__, |  \_____\___/|_|  \___|
#                                  __/ |
#                                 |___/

"""The core package provides the ParaPy grammar, i.e. a set of (descriptor)
classes that can be used to declare cached and dependency-tracked classes
consisting of inputs, attributes and parts.
"""

import warnings

from parapy.core.globs import derived, required
from parapy.core.sequence import Sequence
from parapy.core.base import Base
from parapy.core.dynamic import DynamicType
from parapy.core.input import Input
from parapy.core.attribute import Attribute
from parapy.core.part import Part, HiddenPart
from parapy.core.dependencies import child
from parapy.core.decorators import action, gui_callable, on_event
from parapy.core.io import FileReader, FileWriter
from parapy.core.utilities import *
from parapy.core.collections import List
from parapy.core import validate as val
from parapy.config import CONFIGURATION as _conf

if _conf.getboolean("core.runtime", "cleanup_traceback"):
    from parapy.tb import install_hook as _install_hook

    _install_hook()
    del _install_hook

if _conf.get("general", "IDE") == "PyDev":
    from parapy.core.pydev import patch as _patch

    _patch()

if _conf.getboolean("core.debug", "patch_pydevd_f_trace"):
    from parapy.core.pydev import (
        patch_f_trace as _patch_f_trace, pydevd_running as _pydevd_running)

    if _pydevd_running():
        try:
            _patch_f_trace()
        except Exception as e:
            warnings.warn("Could not patch pydevd f_trace: {}".format(e))


if _conf.getboolean("core.debug", "patch_pydevd_step_compiled_frame"):
    from parapy.core.pydev import (
        pydevd_running as _pydevd_running,
        patch_step_compiled_frame as _patch_step_compiled_frame,
        _get_pydevd_patch_version)

    if _pydevd_running() and _get_pydevd_patch_version() == "2019_2":
        try:
            _patch_step_compiled_frame()
        except Exception as e:
            warnings.warn("Could not apply 'step through compiled frame' "
                          "patch: {}".format(e))
