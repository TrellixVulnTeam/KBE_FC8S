#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
# Copyright (C) 2016-2021 ParaPy Holding B.V.
#
# This file is subject to the terms and conditions defined in
# the license agreement that you have received with this source code
#
# THIS CODE AND INFORMATION ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY
# KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR
# PURPOSE.

"""Utility to attach an icon to a wx.Frame"""

import os

from wx.lib.embeddedimage import PyEmbeddedImage

__all__ = ["set_icon_windows", "set_parapy_icon"]

# used img2py for this.
SNAKE_STR = (
    "iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAX1J"
    "REFUWIW1V9mOwyAMZGD/e90PT70PWSiHDyB0pEoNWJlhahsXiClY4PfF+Ttighm8gR+PnLnw"
    "BwB8WoQqIJMDNx8zh/9nruOeChIF1LaL+wddiT0xvy8O1JJlQgDZhdYZR7CF4kBPHOhD+E2Y"
    "SZhF9DgpCohpPL0jqsuBEOhe38mF6IeMAnIOFPIsbCMXkBvRkguWuEUX1h1wBKy6UAQgJuTf"
    "0iI4jaYKsn1Myim+IADeZVSjsdcSQ9VhnMvM7gMd6hcUlwwhQ1ela2jb20mImFDyxohp8orG"
    "JH1cBTMirJizZTgDal04JoB/7X3NhWUB+cquP6vvqF2YroJCRPILpfg+4xETmNrKmHKglJNE"
    "roHm2rIr4NElNSHCnYpVcm1dEiE0oCkBFnHTFT2rSe+c5lg+nJLGfn6P7yHgJQil7lmAehmp"
    "9guipBjEBLVy6HOQdQEeSHapfq7313NgA9aYppahd8mIoPWZ0B1IzA7Yre+M5dMTkVZqT/+c"
    "/gF+VPs3hHV9vwAAAABJRU5ErkJggg==")

SNAKE_PNG = PyEmbeddedImage(SNAKE_STR)


def set_icon_windows(frame, icon, app_id):
    """Hack for Windows to add a custom taskbar item to a wx.Frame instance.

    .. note:: run this function before ``frame.Show()`` or ``app.MainLoop()``

    :param wx.Frame frame: wx.Frame instance.
    :param wx.Icon icon: icon to attach to frame.
    :param app_id: name to attach to process. Windows only. See
        https://msdn.microsoft.com/en-us/library/windows/desktop/dd378422(v=vs.85).aspx
    :param app_id: str | None
    """
    from parapy.globs import is_frozen
    if not is_frozen() and os.name == "nt":
        # Fix for windows: http://stackoverflow.com/questions/1551605/how-to-
        # set-applications-taskbar-icon-in-windows-7/1552105#1552105
        import ctypes
        ctypes.windll.shell32.SetCurrentProcessExplicitAppUserModelID(app_id)
    frame.SetIcon(icon)


def set_parapy_icon(frame, app_id="ParaPyApp"):
    """Utility to attach the famous ParaPy Snake to you wx.Frame. Usage:

    >>> import wx
    >>> app = wx.App(False)
    >>> frame = wx.Frame(None, title="Frame with ParaPy taskbar icon")
    >>> set_parapy_icon(frame)
    >>> frame.Show()
    True
    >>> frame.Close()
    True
    >>> app.MainLoop()
    0

    .. note:: run this function before ``frame.Show()`` or ``app.MainLoop()``

    :param wx.Frame frame: wx.Frame instance.
    :param app_id: Name to attach to process. Windows only. See
        https://msdn.microsoft.com/en-us/library/windows/desktop/dd378422(v=vs.85).aspx
    :param app_id: str | None
    """
    set_icon_windows(frame, SNAKE_PNG.GetIcon(), app_id=app_id)
